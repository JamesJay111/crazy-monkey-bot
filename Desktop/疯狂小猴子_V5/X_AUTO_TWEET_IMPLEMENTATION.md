# X è‡ªåŠ¨å‘æ¨åŠŸèƒ½å®ç°æ–‡æ¡£

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

å®ç°äº† X (Twitter) è‡ªåŠ¨å‘æ¨ä»»åŠ¡ï¼Œæ¯ 8 å°æ—¶è‡ªåŠ¨å‘æ¨ä¸€æ¬¡ï¼Œé€‰æ‹© Binance åˆçº¦ä¸­ 8 å°æ—¶å†… Taker å¢é•¿æœ€å¿«çš„äº¤æ˜“å¯¹ã€‚

## ğŸ—‚ï¸ æ–‡ä»¶æ¸…å•

### æ–°å¢æ–‡ä»¶

1. **`src/services/xTweet.service.ts`**
   - Twitter å‘æ¨æœåŠ¡
   - å°è£…å‘æ¨é€»è¾‘ï¼Œè‡ªåŠ¨å¤„ç† token åˆ·æ–°
   - æ”¯æŒ 401 é”™è¯¯è‡ªåŠ¨é‡è¯•ï¼ˆåˆ·æ–° token åé‡è¯•ä¸€æ¬¡ï¼‰

2. **`src/services/binanceUniverse.service.ts`**
   - Binance åˆçº¦ Universe æœåŠ¡
   - è·å– Binance åˆçº¦å¯ç”¨äº¤æ˜“å¯¹åˆ—è¡¨
   - ç¼“å­˜ç­–ç•¥ï¼š24 å°æ—¶æ›´æ–°ä¸€æ¬¡

3. **`src/services/takerGrowth.service.ts`**
   - Taker å¢é•¿è®¡ç®—æœåŠ¡
   - è®¡ç®— 8h å†… Taker æ€»é‡å¢é•¿æœ€å¿«çš„äº¤æ˜“å¯¹
   - æ”¯æŒå¹¶å‘è®¡ç®—ï¼ˆé™åˆ¶ 5 ä¸ªå¹¶å‘ï¼Œé¿å… API é™æµï¼‰

4. **`src/services/tweetContent.service.ts`**
   - æ¨æ–‡å†…å®¹ç”ŸæˆæœåŠ¡
   - æ ¼å¼åŒ–æ¨æ–‡æ¨¡æ¿ï¼ˆæ•°å€¼æ ¼å¼ï¼šMã€ç™¾åˆ†æ¯”ç­‰ï¼‰
   - è°ƒç”¨ DeepSeek ç”Ÿæˆä¸€å¥è¯ç»“è®º

5. **`src/services/xAutoTweetJob.service.ts`**
   - è‡ªåŠ¨å‘æ¨ Job æœåŠ¡
   - è°ƒåº¦é€»è¾‘ï¼šå¯åŠ¨åç«‹å³æ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åæ¯ 8 å°æ—¶æ‰§è¡Œ
   - å¹‚ç­‰æ€§ï¼šé˜²æ­¢åœ¨åŒä¸€ 8 å°æ—¶ bucket å†…é‡å¤å‘ç›¸åŒ ticker
   - çŠ¶æ€å­˜å‚¨ï¼š`./data/x_tweet_state.json`

### ä¿®æ”¹æ–‡ä»¶

1. **`src/bot/index.ts`**
   - æ–°å¢ï¼šåˆå§‹åŒ– X è‡ªåŠ¨å‘æ¨ Job ç›¸å…³æœåŠ¡
   - æ–°å¢ï¼šå¯åŠ¨ Jobï¼ˆåœ¨ Bot å¯åŠ¨åï¼‰
   - æ–°å¢ï¼šä¼˜é›…å…³é—­æ—¶åœæ­¢ Job

## ğŸš€ å¯åŠ¨æ–¹å¼

### 1. å‰ç½®æ¡ä»¶

ç¡®ä¿å·²å®Œæˆ X OAuth æˆæƒï¼š
- Token å·²ä¿å­˜åˆ° `./data/x_tokens.json`
- Token åŒ…å« `refresh_token`ï¼ˆç”¨äºè‡ªåŠ¨åˆ·æ–°ï¼‰

### 2. å¯åŠ¨ Bot

```bash
# æ–¹å¼ 1: ä½¿ç”¨å¯åŠ¨è„šæœ¬
./start.sh

# æ–¹å¼ 2: ç›´æ¥è¿è¡Œ
npm run dev
```

### 3. éªŒè¯å¯åŠ¨

å¯åŠ¨åï¼ŒæŸ¥çœ‹æ—¥å¿—ï¼š

```bash
tail -f bot.log | grep -i "tweet\|x auto"
```

åº”è¯¥çœ‹åˆ°ï¼š
```
âœ… X è‡ªåŠ¨å‘æ¨ä»»åŠ¡å·²å¯åŠ¨
Running tweet job...
```

## ğŸ“Š å·¥ä½œæµç¨‹

### 1. é€‰å¸æµç¨‹

```
1. è·å– Binance Universeï¼ˆå€™é€‰äº¤æ˜“å¯¹åˆ—è¡¨ï¼‰
   â†“
2. å¹¶å‘è®¡ç®—æ¯ä¸ªäº¤æ˜“å¯¹çš„ 8h Taker å¢é•¿
   â†“
3. é€‰æ‹©å¢é•¿å€¼æœ€å¤§çš„äº¤æ˜“å¯¹
   â†“
4. æ£€æŸ¥å¹‚ç­‰æ€§ï¼ˆæ˜¯å¦åœ¨åŒä¸€ bucket å†…å·²å‘è¿‡ï¼‰
   â†“
5. è·å–åˆçº¦å¿«ç…§æ•°æ®ï¼ˆOIã€Fundingã€Takerã€Topï¼‰
   â†“
6. ç”Ÿæˆæ¨æ–‡å†…å®¹ï¼ˆæ ¼å¼åŒ– + DeepSeek ç»“è®ºï¼‰
   â†“
7. å‘é€æ¨æ–‡
   â†“
8. ä¿å­˜çŠ¶æ€ï¼ˆç”¨äºå¹‚ç­‰æ€§æ£€æŸ¥ï¼‰
```

### 2. Taker å¢é•¿è®¡ç®—é€»è¾‘

**ä¼ªä»£ç ï¼š**
```typescript
// 1. è·å–æœ€è¿‘ 2 æœŸçš„ 8h Taker æ•°æ®
const history = await getTakerBuySellVolumeHistory({
  exchange: 'Binance',
  symbol: 'BTCUSDT',
  interval: '8h',
  limit: 2,
});

// 2. è®¡ç®— Taker æ€»é‡
const currentTotal = history[0].taker_buy_volume_usd + history[0].taker_sell_volume_usd;
const previousTotal = history[1].taker_buy_volume_usd + history[1].taker_sell_volume_usd;

// 3. è®¡ç®—å¢é•¿ï¼ˆå·®å€¼ï¼‰
const growth = currentTotal - previousTotal;

// 4. é€‰æ‹©å¢é•¿å€¼æœ€å¤§çš„äº¤æ˜“å¯¹
```

### 3. æ¨æ–‡æ¨¡æ¿

```
ğŸ§¨ åˆçº¦ç»“æ„é¢„è­¦ï½œ{TICKER}ï¼ˆBinance Â· 8Hï¼‰

- OIï¼ˆ4hï¼‰ï¼š${oi_usd}
- Fundingï¼š{funding_rate_pct}
- Takerï¼šä¹° ${taker_buy_usd} / å– ${taker_sell_usd}
- Topï¼šå¤š {top_long_pct}% / ç©º {top_short_pct}%ï½œæ¯” {top_ls_ratio}

ç»“è®ºï¼š{one_liner}

âš ï¸ ç»“æ„è§‚å¯Ÿï¼Œä¸æ„æˆäº¤æ˜“å»ºè®®
```

### 4. æ•°å€¼æ ¼å¼è§„åˆ™

- **é‡‘é¢ï¼ˆOIã€Takerï¼‰**ï¼š
  - â‰¥ 1,000,000 â†’ `$107.56M`
  - < 1,000,000 â†’ `$1,234,567.89`

- **Funding Rate**ï¼š
  - è½¬æˆç™¾åˆ†æ¯”ï¼Œä¿ç•™ 2 ä½å°æ•°ï¼š`+0.35%` æˆ– `-0.35%`

- **ç™¾åˆ†æ¯”**ï¼šä¿ç•™ 2 ä½ï¼š`45.67%`

- **å¤šç©ºæ¯”**ï¼šä¿ç•™ 2 ä½ï¼š`1.23`

## ğŸ”’ å¹‚ç­‰æ€§æœºåˆ¶

### çŠ¶æ€å­˜å‚¨

æ–‡ä»¶ï¼š`./data/x_tweet_state.json`

æ ¼å¼ï¼š
```json
{
  "lastTweetAt": 1703232000000,
  "lastTweetTicker": "BTC",
  "lastTweetKey": "BTC:8h:212904"
}
```

### åˆ†æ¡¶è§„åˆ™

- æŒ‰ 8 å°æ—¶åˆ†æ¡¶ï¼ˆæŒ‰æ•´ç‚¹åˆ†æ¡¶ï¼‰
- æ¡¶ ID = `Math.floor(timestamp / (8 * 60 * 60 * 1000))`
- åœ¨åŒä¸€ bucket å†…ï¼Œå¦‚æœ ticker ç›¸åŒï¼Œåˆ™è·³è¿‡å‘æ¨

### ç¤ºä¾‹

```
æ—¶é—´ 12:00 â†’ bucket = 212904
æ—¶é—´ 19:59 â†’ bucket = 212904ï¼ˆåŒä¸€ bucketï¼‰
æ—¶é—´ 20:00 â†’ bucket = 212905ï¼ˆæ–° bucketï¼‰
```

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### 1. Token ç›¸å…³

**é—®é¢˜ï¼š** `No valid access token`

**æ’æŸ¥ï¼š**
1. æ£€æŸ¥ `./data/x_tokens.json` æ˜¯å¦å­˜åœ¨
2. æ£€æŸ¥ token æ˜¯å¦è¿‡æœŸï¼ˆæŸ¥çœ‹ `expiresAt`ï¼‰
3. æ£€æŸ¥æ˜¯å¦æœ‰ `refresh_token`

**è§£å†³ï¼š**
```bash
# é‡æ–°æˆæƒ
npm run oauth
# è®¿é—® http://localhost:8787/x/auth
```

### 2. API é™æµ

**é—®é¢˜ï¼š** `CoinGlass API è¯·æ±‚é¢‘ç‡è¶…é™`

**æ’æŸ¥ï¼š**
- CoinGlass API æœ‰å¹¶å‘é™åˆ¶ï¼ˆå½“å‰è®¾ç½®ä¸º 5 ä¸ªå¹¶å‘ï¼‰
- å¦‚æœ Universe å¤ªå¤§ï¼Œå¯èƒ½éœ€è¦åˆ†æ‰¹å¤„ç†

**è§£å†³ï¼š**
- ç­‰å¾…ä¸€æ®µæ—¶é—´åé‡è¯•
- æˆ–å‡å°‘ Universe æ•°é‡ï¼ˆä¿®æ”¹ `binanceUniverse.service.ts` ä¸­çš„é™åˆ¶ï¼‰

### 3. æ— æœ‰æ•ˆæ•°æ®

**é—®é¢˜ï¼š** `No valid taker growth found`

**æ’æŸ¥ï¼š**
- å¯èƒ½æ‰€æœ‰äº¤æ˜“å¯¹çš„ Taker æ•°æ®ä¸è¶³ï¼ˆéœ€è¦è‡³å°‘ 2 æœŸæ•°æ®ï¼‰
- æˆ–æ‰€æœ‰äº¤æ˜“å¯¹çš„å¢é•¿éƒ½ä¸ºè´Ÿ

**è§£å†³ï¼š**
- è¿™æ˜¯æ­£å¸¸æƒ…å†µï¼ŒJob ä¼šè·³è¿‡æœ¬æ¬¡å‘æ¨
- ç­‰å¾…ä¸‹ä¸ªå‘¨æœŸï¼ˆ8 å°æ—¶åï¼‰å†è¯•

### 4. DeepSeek ç”Ÿæˆå¤±è´¥

**é—®é¢˜ï¼š** `Failed to generate one-liner`

**æ’æŸ¥ï¼š**
- DeepSeek API Key æ˜¯å¦æœ‰æ•ˆ
- è´¦æˆ·ä½™é¢æ˜¯å¦å……è¶³

**è§£å†³ï¼š**
- ç³»ç»Ÿä¼šè‡ªåŠ¨ä½¿ç”¨ Fallback ç»“è®ºï¼ˆåŸºäºæ•°æ®ç”Ÿæˆç®€å•æè¿°ï¼‰
- æ£€æŸ¥ DeepSeek API Key é…ç½®

### 5. æ¨æ–‡å‘é€å¤±è´¥

**é—®é¢˜ï¼š** `Failed to send tweet`

**æ’æŸ¥ï¼š**
- Token æ˜¯å¦è¿‡æœŸï¼ˆ401 é”™è¯¯ä¼šè‡ªåŠ¨é‡è¯•ä¸€æ¬¡ï¼‰
- Twitter API æ˜¯å¦æ­£å¸¸
- æ¨æ–‡å†…å®¹æ˜¯å¦è¶…è¿‡ 280 å­—ç¬¦é™åˆ¶

**è§£å†³ï¼š**
- æŸ¥çœ‹æ—¥å¿—ä¸­çš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
- å¦‚æœ 401ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ·æ–° token å¹¶é‡è¯•ä¸€æ¬¡
- å¦‚æœä»ç„¶å¤±è´¥ï¼Œç­‰å¾…ä¸‹ä¸ªå‘¨æœŸ

## ğŸ“ æ—¥å¿—æŸ¥çœ‹

### å®æ—¶æ—¥å¿—

```bash
tail -f bot.log | grep -i "tweet\|x auto\|taker growth"
```

### å…³é”®æ—¥å¿—

- `Starting X auto tweet job` - Job å¯åŠ¨
- `Running tweet job...` - å¼€å§‹æ‰§è¡Œä»»åŠ¡
- `Fastest taker growth selected` - é€‰å¸å®Œæˆ
- `Tweet sent successfully` - æ¨æ–‡å‘é€æˆåŠŸ
- `Tweet skipped (duplicate in same bucket)` - å¹‚ç­‰æ€§è·³è¿‡

### Mac æ¡Œé¢æ—¥å¿—æ–‡ä»¶

æ¯æ¬¡å‘é€æ¨æ–‡ï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰éƒ½ä¼šåœ¨ **Mac æ¡Œé¢**ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ï¼š

**æ–‡ä»¶ä½ç½®ï¼š** `~/Desktop/X_Tweet_Log_YYYY-MM-DD.txt`

**æ–‡ä»¶æ ¼å¼ï¼š**
- æŒ‰æ—¥æœŸåˆ†æ–‡ä»¶ï¼ˆæ¯å¤©ä¸€ä¸ªæ–‡ä»¶ï¼‰
- è¿½åŠ æ¨¡å¼ï¼ˆåŒä¸€å¤©å¤šæ¬¡å‘æ¨ä¼šè¿½åŠ åˆ°åŒä¸€æ–‡ä»¶ï¼‰
- åŒ…å«æ—¶é—´æˆ³ã€çŠ¶æ€ã€å¸ç§ã€æ¨æ–‡å†…å®¹ã€é”™è¯¯ä¿¡æ¯ç­‰

**æˆåŠŸæ—¥å¿—ç¤ºä¾‹ï¼š**
```
âœ… Twitter æ¨æ–‡å‘é€æˆåŠŸ

æ—¶é—´: 2025-12-23 12:43:15 (2025-12-23T04:43:15.000Z)
çŠ¶æ€: æˆåŠŸ
å¸ç§: BTC
æ¨æ–‡ ID: 1234567890123456789
æ¨æ–‡ URL: https://twitter.com/i/web/status/1234567890123456789
Taker å¢é•¿: 1,234,567.89 USD
Taker å¢é•¿ç™¾åˆ†æ¯”: 15.23%

æ¨æ–‡å†…å®¹:
ğŸ§¨ åˆçº¦ç»“æ„é¢„è­¦ï½œBTCï¼ˆBinance Â· 8Hï¼‰
...
```

**å¤±è´¥æ—¥å¿—ç¤ºä¾‹ï¼š**
```
âŒ Twitter æ¨æ–‡å‘é€å¤±è´¥

æ—¶é—´: 2025-12-23 12:43:15 (2025-12-23T04:43:15.000Z)
çŠ¶æ€: å¤±è´¥
å¸ç§: BTC
é”™è¯¯ä¿¡æ¯: No valid access token. Please authorize first.
Taker å¢é•¿: 1,234,567.89 USD
Taker å¢é•¿ç™¾åˆ†æ¯”: 15.23%

æ¨æ–‡å†…å®¹ï¼ˆæœªå‘é€ï¼‰:
ğŸ§¨ åˆçº¦ç»“æ„é¢„è­¦ï½œBTCï¼ˆBinance Â· 8Hï¼‰
...
```

## ğŸ”§ å¼€å‘æµ‹è¯•

### ç¼©çŸ­é—´éš”ï¼ˆå¼€å‘ç”¨ï¼‰

ä¿®æ”¹ `src/services/xAutoTweetJob.service.ts`ï¼š

```typescript
// å¼€å‘æµ‹è¯•ï¼šæ”¹ä¸º 1 åˆ†é’Ÿ
private readonly INTERVAL_MS = 1 * 60 * 1000; // 1 åˆ†é’Ÿ

// ç”Ÿäº§ç¯å¢ƒï¼šæ¢å¤ä¸º 8 å°æ—¶
private readonly INTERVAL_MS = 8 * 60 * 60 * 1000; // 8 å°æ—¶
```

### æ‰‹åŠ¨è§¦å‘

å¯ä»¥åœ¨ä»£ç ä¸­ä¸´æ—¶è°ƒç”¨ï¼š

```typescript
await xAutoTweetJob.runTweetJobOnce();
```

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **Universe æ›´æ–°é¢‘ç‡**ï¼šæ¯å¤©ä¸€æ¬¡ï¼ˆå¯åŠ¨æ—¶æˆ–ç¼“å­˜è¿‡æœŸæ—¶ï¼‰
2. **å¹¶å‘æ§åˆ¶**ï¼šTaker å¢é•¿è®¡ç®—é™åˆ¶ 5 ä¸ªå¹¶å‘ï¼Œé¿å… API é™æµ
3. **å¹‚ç­‰æ€§**ï¼šç¡®ä¿åŒä¸€ 8 å°æ—¶ bucket å†…ä¸ä¼šé‡å¤å‘ç›¸åŒ ticker
4. **é”™è¯¯å¤„ç†**ï¼šJob å¤±è´¥ä¸ä¼šå½±å“ä¸‹ä¸ªå‘¨æœŸï¼Œä¹Ÿä¸ä¼šå¯¼è‡´è¿›ç¨‹å´©æºƒ
5. **Token åˆ·æ–°**ï¼šè‡ªåŠ¨å¤„ç† token è¿‡æœŸï¼Œæœ€å¤šé‡è¯• 1 æ¬¡

## âœ… éªŒæ”¶æ ‡å‡†

- [x] å¯åŠ¨æœåŠ¡å 1 åˆ†é’Ÿå†…è‡ªåŠ¨å‘å‡º 1 æ¡æ¨æ–‡
- [x] æ¨æ–‡å†…å®¹ç¬¦åˆæ¨¡æ¿ï¼Œæ•°å€¼æ ¼å¼æ­£ç¡®ï¼ˆMã€Funding%ï¼‰
- [x] ä¸‹ä¸€æ¬¡æ‰§è¡Œåœ¨ 8 å°æ—¶åè§¦å‘
- [x] é€‰å¸æ¥è‡ª Binance åˆçº¦ï¼Œä¸”æŒ‰ 8h å†… Taker å¢é•¿æœ€å¤§é€‰æ‹©
- [x] é‡å¯æœåŠ¡ä¸ä¼šåœ¨åŒä¸€ 8 å°æ—¶æ¡¶é‡Œé‡å¤å‘åŒä¸€ ticker
- [x] Token è¿‡æœŸæ—¶è‡ªåŠ¨åˆ·æ–°å¹¶é‡è¯•
- [x] æ¨æ–‡å‘é€å¤±è´¥ä¸å½±å“ä¸‹ä¸ªå‘¨æœŸ

